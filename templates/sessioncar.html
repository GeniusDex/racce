{{$session := .Session}}
{{$car := .Car}}
{{template "header.inc.html" (print $session.TrackName " - Car " $car.RaceNumber)}}

<div class="mdl-grid">

<div class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--4-col drivers_card">
  <div class="mdl-card__title">
    <h2 class="mdl-card__title-text mdl-typography--title">Drivers</h2>
  </div>
  <div class="mdl-card__list">
    <ul class="mdl-list drivers_list">
    {{range .Car.Drivers}}
      <li class="mdl-list__item">
        <span class="mdl-list__item-primary-content">
          <i class="material-icons mdl-list__item-icon">person</i>
          <a href="{{basePath}}/player/{{.PlayerId}}">{{.FirstName}} {{.LastName}}</a>
        </span>
      </li>
    {{end}}
    </ul>
  </div>
</div>
<div class="mdl-cell mdl-cell--8-col"></div>


<div class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col">
  <div class="mdl-card__title mdl-card--table__header">
    <h2 class="mdl-card__title-text mdl-typography--title">Lap times</h2>
  </div>
  <div class="mdl-card__table">
    <table class="mdl-data-table mdl-js-data-table">
      <thead>
        <tr>
          <th>Lap</th>
          <th class="mdl-data-table__cell--non-numeric">Driver</th>
          <th>Laptime</th>
          <th>Sector 1</th>
          <th>Sector 2</th>
          <th>Sector 3</th>
          <th class="mdl-data-table__cell--non-numeric">Valid</th>
        </tr>
      </thead>
      <tbody>
{{$lapnr := 0}}
{{range $lap := $session.Laps}}
    {{if eq .CarId $car.CarId}}
        {{$lapnr = add $lapnr 1}}
        <tr>
          <td>{{$lapnr}}</td>
          <td class="mdl-data-table__cell--non-numeric">{{(index $car.Drivers .DriverIndex).ShortName}}</td>
          <td>{{laptime .Laptime}}</td>
          <td>{{laptime (index .Splits 0)}}</td>
          <td>{{laptime (index .Splits 1)}}</td>
          <td>{{laptime (index .Splits 2)}}</td>
          <td class="mdl-data-table__cell--non-numeric">{{if .IsValidForBest}}true{{else}}false{{end}}</td>
        </tr>
    {{end}}
{{end}}
      </tbody>
    </table>
  </div>
  <div class="mdl-card__supporting-text laptimes_chart_container">
    <canvas id="lapTimesChart" width="400" height="150"></canvas>
  </div>
</div>

<script>
var ctx = document.getElementById('lapTimesChart').getContext('2d');
var myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [{{$lapnr := 0}}{{range $session.Laps}}{{if eq .CarId $car.CarId}}{{$lapnr = add $lapnr 1}}{{$lapnr}}, {{end}}{{end}}],
        datasets: [{
            label: 'Lap',
            backgroundColor: 'rgba(1, 51, 112, 1)',
            borderColor: 'rgba(1, 51, 112, 1)',
            borderWidth: 2,
            fill: false,
            data: [{{range $session.Laps}}{{if eq .CarId $car.CarId}}{{div .Laptime 1000}}, {{end}}{{end}}],
        },
        {
            label: 'Sector 1',
            backgroundColor: 'rgba(255, 0, 0, 1)',
            borderColor: 'rgba(255, 0, 0, 1)',
            borderWidth: 2,
            fill: false,
            data: [{{range $session.Laps}}{{if eq .CarId $car.CarId}}{{div (index .Splits 0) 1000}}, {{end}}{{end}}],
        },
        {
            label: 'Sector 2',
            backgroundColor: 'rgba(0, 255, 0, 1)',
            borderColor: 'rgba(0, 255, 0, 1)',
            borderWidth: 2,
            fill: false,
            data: [{{range $session.Laps}}{{if eq .CarId $car.CarId}}{{div (index .Splits 1) 1000}}, {{end}}{{end}}],
        },
        {
            label: 'Sector 3',
            backgroundColor: 'rgba(0, 0, 255, 1)',
            borderColor: 'rgba(0, 0, 255, 1)',
            borderWidth: 2,
            fill: false,
            data: [{{range $session.Laps}}{{if eq .CarId $car.CarId}}{{div (index .Splits 2) 1000}}, {{end}}{{end}}],
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});
</script>

{{template "footer.inc.html"}}
